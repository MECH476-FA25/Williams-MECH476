---
title: 'MECH481A6: Engineering Data Analysis in R'
subtitle: 'Chapter 5 Homework: Exploring Univariate Data' 
author: 'Student Name'
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: html_document
---

```{r global-options, include = FALSE}
# set global options for figures, code, warnings, and messages
knitr::opts_chunk$set(fig.width = 6, fig.height = 4, fig.path = "../figs/",
                      echo = FALSE, warning = FALSE, message = FALSE)
```

# Grading

We will grade the **knitted** PDF or HTML document from within your private
GitHub repository. Remember to make regular, small commits (e.g., at least one
commit per question) to save your work. We will grade the latest knit, as long
as it occurs *before* the start of the class in which we advance to the next
chapter. As always, reach out with questions via GitHub Issues or during
office hours.

# Data

You are probably sick of seeing the ozone data, but there's still more to
do with the file. Ozone concentration measurement is considered univariate,
thus we can use basic exploratory data analysis approaches to examine the data.

# Preparation

Load the necessary R packages into your R session. 

```{r packages, message=FALSE}
# load packages
library(tidyverse)
library(ggplot2)
library(dplyr)
```

Recreate the pipe of `dplyr` functions that you used to import the data, select
and rename the variables listed below, drop missing observations, and assign the
output with a good name.

- `sample_measurement` renamed as `ozone_ppm` (ozone measurement in ppm)
- `datetime` (date in YYYY-MM-DD format and time of measurement in HH:MM:SS)

```{r import-data, message=FALSE}
# ozone: import, select, drop missing observations, rename
ftc <- read_csv("ftc_o3.csv")
ftc <- ftc %>%
  select(site_number, latitude, longitude,
  date_local, time_local, datetime, sample_measurement, units_of_measure,
  sample_duration, method)

ftc <- ftc %>%
  mutate(datetime = ymd_hms(datetime),
  ozone_ppm = sample_measurement)
ftc_clean <- ftc %>% filter(!is.na(ozone_ppm))

MW <- 47.998 # g/mol
T_c <- 10 # Celsius
temp_K <- 273.15 + T_c
P <- 637 # mmHg
R <- 22.4136 # (L*atm)/(mol*K)
ftc_clean <- ftc_clean %>%
  mutate(ozone_ugm3 = 1000 * ((ozone_ppm * MW * temp_K * P) / (R * (temp_K) *   P)))
ftc_clean %>% select(datetime, ozone_ppm, ozone_ppm, ozone_ugm3)
```

Check that the data imported correctly.

```{r data-check}
# examine dataframe object 
summary(ftc_clean)
```

\newpage

# Chapter 5 Homework: Exploring Univariate Data

Through Question 5, you will use all of the available ozone measurements
from January 2019 through January 2020. Starting in Question 6, you will use
a subset of the dataset: ozone concentration measurements on July 4, 2019.

## Question 1: Definitions

Guess the location, dispersion, and shape of ozone concentration data, based on
the definitions of each described in the coursebook. No code needed; just use
your intuition. For shape, take a look at the coursebook appendix on reference
distributions.

Answer:
- Location: Ozone concentration (hourly) is expected to have a central
  tendency somewhere near the lower-to-mid range of observed values; for
  Fort Collins typical hourly ozone (ppb) will often center in the low
  tens to a few tens of ppb rather than very high values.
- Dispersion: Hourly ozone shows moderate spread because of diurnal
  cycles and meteorology â€” expect variability across days and seasons.
- Shape: I expect a right-skewed distribution (longer tail toward higher
  ozone values) because episodic high-ozone events push the upper tail
  while most hours are lower.

## Question 2: Quartiles

Calculate the quartiles of `ozone_ppm`. What is the minimum? Maximum? Median? 

```{r ozone-quartiles}

ftc_clean %>%
  summarise(
    min_value = min(.data$ozone_ppm, na.rm = TRUE),
    q1 = quantile(.data$ozone_ppm, 0.25, na.rm = TRUE),
    median_value = median(.data$ozone_ppm, na.rm = TRUE),
    q3 = quantile(.data$ozone_ppm, 0.75, na.rm = TRUE),
    max_value = max(.data$ozone_ppm, na.rm = TRUE)
  )

ftc
```

### Extra Credit

Create [a similar table](https://smogdr.github.io/edar_coursebook/eda1.html#descriptive-statistics) for `ozone_ppm`. Hint: You will need to investigate table
options in the `knitr` package.

\newpage

## Question 3: Cumulative Distribution Plot

Using either relevant `ggplot2` `geom` option, create a cumulative distribution
plot of `ozone_ppm`. Tweak the axis ranges for optimal data representation,
using `scale_*_continuous()` with `breaks =` and `minor_breaks =` arguments.
Add axis labels, title, subtitle, and theme. 

```{r ozone-cd}
# plot cumulative distribution of ozone concentration
ggplot(ftc_clean, aes(x = ozone_ppm)) +
  stat_ecdf(geom = "step", color = "blue", linewidth = 1) +  # use linewidth instead of size
  scale_x_continuous(
    name = "Ozone (ppm)",
    breaks = seq(0, 0.15, by = 0.02),
    minor_breaks = seq(0, 0.15, by = 0.01),
    limits = c(0, 0.15)
  ) +
  scale_y_continuous(
    name = "Cumulative Probability",
    breaks = seq(0, 1, by = 0.1),
    minor_breaks = seq(0, 1, by = 0.05),
    limits = c(0, 1)
  ) +
  labs(
    title = "Cumulative Distribution of Ozone",
    subtitle = "Empirical CDF for ozone_ppm measurements"
  ) +
  theme_minimal(base_size = 14)
```

\newpage

## Question 4: Histogram

Create a histogram of `ozone_ppm`. Within the `geom`, mess with the number of
bins (e.g., 20, 50, 75, 100, 200) to explore the true shape and granularity of
the data. Match the plot style (e.g., title, subtitle, axis labels, theme) you
chose in Question 3, with the relevant adjustments such as "Histogram" 
instead of "Cumulative Distribution Plot".

```{r ozone-hist}
# create histogram of ozone concentration
ggplot(ftc_clean, aes(x = ozone_ppm)) +
  geom_histogram(bins = 50, fill = "skyblue", color = "black") +
  scale_x_continuous(
    name = "Ozone (ppm)",
    breaks = seq(0, 0.15, by = 0.02),
    minor_breaks = seq(0, 0.15, by = 0.01),
    limits = c(0, 0.15)
  ) +
  scale_y_continuous(
    name = "Frequency",
    breaks = seq(0, 25, by = 5),         # adjust based on your data
    minor_breaks = seq(0, 25, by = 1)
  ) +
  labs(
    title = "Histogram of Ozone",
    subtitle = "Distribution of ozone_ppm measurements"
  ) +
  theme_minimal(base_size = 14)
```

### Question 5: Concept

What mathematical concept is a histogram (Q4) attempting to visualize? 

Answer:
  A histogram is a graphical tool used to visualize the frequency distribution of a dataset. It divides the data into intervals, or bins, and shows how often values fall within each range. In effect, it approximates the probability density function of a continuous variable and allows us to understand the shape, central tendency, spread, and variability of the data.

### Question 6: Distribution

Based on the histogram (Q4), does ozone concentration appear to be normally
distributed? 

Answer:
  Based on the histogram, the distribution does not appear to be normally distributed. Rather than forming a symmetric bell-shaped curve, the data seems to be left-skewed, with most ozone measurements clustered closer to the lower values and middle values while fewer observations at higher concentrations.

### Question 7: Outliers

Based on the histogram (Q4), do you see any possible outliers? Skewness? How
might this affect the spread and central tendency?

Answer:
  The histogram also suggests the presence of possible outliers, particularly in the higher range of ozone concentrations. This skewness and the presence of extreme values can influence measures of central tendency and spread. Specifically, the mean is likely pulled toward the larger values, making it higher than the median, whereas the median provides a more robust measure of central tendency. Similarly, measures like the interquartile range are better suited for describing the spread of skewed data, as they are less affected by outliers.


\newpage

## Question 8: Boxplot

Generate a boxplot of ozone concentration on the y-axis with a title, subtitle,
y-axis label, and theme consistent with the style of the previous two plots. 
Use quotes (`""`) as the `x` arguments within the calls to the aesthetic and 
labels to remove the x-axis scale and label.

```{r ozone-boxplot}
# create ozone boxplot
ggplot(ftc_clean, aes(x = "", y = ozone_ppm)) +  # empty x-axis
  geom_boxplot(fill = "lightblue", color = "black", outlier.color = "red", outlier.shape = 16) +
  scale_y_continuous(
    name = "Ozone (ppm)",
    breaks = seq(0, 0.15, by = 0.02),
    minor_breaks = seq(0, 0.15, by = 0.01),
    limits = c(0, 0.15)
  ) +
  labs(
    title = "Boxplot of Ozone",
    subtitle = "Distribution of ozone_ppm measurements",
    x = ""  # remove x-axis label
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_blank(),  # remove x-axis text
    axis.ticks.x = element_blank()  # remove x-axis ticks
  )
```

\newpage

# Subset Data

Use the following code to create a dataframe for use in the remaining questions.
These ozone concentration measurements were taken on July 4, 2019 in Fort
Collins, CO. This code detects certain characters with the `datetime` object and
filters to observations containing those characters. There are other ways this 
could have been done (e.g., `dplyr::filter()` with `%in%` operator).

```{r ozone-day}
# create subset of data with only one day to examine daily pattern
# I did not ask you to code this because we have not discussed dates or stringr
# You need to uncomment the below three lines and run it; check object names
ozone_day <- ftc_clean %>% 
   dplyr::filter(stringr::str_detect(string = datetime,
                                     pattern = "2019-07-04"))
```

## Question 9: Autocorrelation Plot

Define autocorrelation as it relates to ozone concentration measurement. 

Definiton:
  Autocorrelation measures the correlation of a variable with itself at different time lags. In the context of ozone concentration measurements, it indicates whether ozone levels at one time point are related to levels at earlier (or later) time points. Positive autocorrelation means high values tend to follow high values and low values follow low values, while negative autocorrelation means high values tend to follow low values. Detecting autocorrelation helps identify temporal patterns, persistence, or periodicity in ozone measurements.

Create an autocorrelation plot of ozone concentration, using `stats::acf()` and
include axis labels and title. Describe what you see based on the features of
interest outlined in the coursebook.

```{r ozone-acf}
# create autocorrelation plot with ozone_day df
acf(ozone_day$ozone_ppm, 
    main = "Autocorrelation of Ozone Concentration",
    xlab = "Lag",
    ylab = "Autocorrelation",
    na.action = na.pass)
```

\newpage

## Question 10: Parial Autocorrelation Plot

Define partial autocorrelation as it relates to ozone concentration measurement.

Definition:
  Partial autocorrelation measures the correlation between a variable and its lagged values while removing the effect of intermediate lags. In the context of ozone concentration measurements, it tells us how ozone levels on a given day are directly related to levels from previous days, after accounting for the influence of all shorter lags. This is useful for identifying the direct temporal dependencies in the data, rather than the combined effect captured by the full autocorrelation.

Now create a partial autocorrelation plot of day ozone concentration with axis
labels. Describe what you see. How does this compare to the autocorrelation
plot in the previous question?

```{r ozone-part-acf}
# create partial autocorrelation plot
pacf(ozone_day$ozone_ppm,
     main = "Partial Autocorrelation of Ozone Concentration",
     xlab = "Lag",
     ylab = "Partial Autocorrelation",
     na.action = na.pass)
```

\newpage

# Appendix

```{r show_code, ref.label = knitr::all_labels(), echo = TRUE, eval = FALSE}
```
